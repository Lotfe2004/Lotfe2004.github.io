<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<title>Web GIS â€“ Ramallah Schools Analysis</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

<style>
body { margin:0; font-family: Arial; }
#map { height: 100vh; }
.popup-title { font-weight: bold; color:#0a3d62 }
.good { color: green; font-weight:bold }
.bad { color: red; font-weight:bold }
</style>
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// ================== Ø§Ù„Ø®Ø±ÙŠØ·Ø© ==================
var map = L.map("map").setView([31.9, 35.2], 11);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "Â© OpenStreetMap"
}).addTo(map);

// ================== Layer Groups ==================
var settlementsLayer = L.layerGroup().addTo(map);
var schoolsLayer = L.layerGroup().addTo(map);
var hospitalsLayer = L.layerGroup().addTo(map);
var clinicsLayer = L.layerGroup().addTo(map);
var wadisLayer = L.layerGroup().addTo(map);
var wellsLayer = L.layerGroup().addTo(map);
var roadsLayer = L.layerGroup().addTo(map);
var proposedSchoolsLayer = L.layerGroup().addTo(map);

// ================== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ ==================
fetch("Ramallah_Schools.json")
.then(res => res.json())
.then(data => {
  L.geoJSON(data, {
    pointToLayer: (f, latlng) =>
      L.circleMarker(latlng, {
        radius:5,
        color:"blue",
        fillColor:"blue",
        fillOpacity:0.9
      }),
    onEachFeature: (f, l) => {
      l.bindPopup("<b>Ù…Ø¯Ø±Ø³Ø©</b><br>Ø§Ù„Ø§Ø³Ù…: " + (f.properties.name || "ØºÙŠØ± Ù…ØªÙˆÙØ±"));
    }
  }).addTo(schoolsLayer);
});

// ================== Ø§Ù„Ù…Ø³ØªÙˆØ·Ù†Ø§Øª ==================
fetch("settlements.geojson")
.then(res => res.json())
.then(data => {
  L.geoJSON(data, {
    style:{ color:"red", fillOpacity:0.3 },
    onEachFeature:(f,l)=>{
      l.bindPopup("âš ï¸ Ù…Ø³ØªÙˆØ·Ù†Ø©<br>Ù…Ù†Ø·Ù‚Ø© Ù…Ù…Ù†ÙˆØ¹Ø© Ù„Ù„Ø¨Ù†Ø§Ø¡");
    }
  }).addTo(map);
});

// ================== Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª ==================
fetch("hospitals.geojson")
.then(res => res.json())
.then(data => {
  L.geoJSON(data,{
    pointToLayer:(f,ll)=>L.marker(ll),
    onEachFeature:(f,l)=>{
      l.bindPopup("ğŸ¥ Ù…Ø³ØªØ´ÙÙ‰<br>" + (f.properties.name || ""));
    }
  }).addTo(hospitalsLayer);
});

// ================== Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª ==================
fetch("clinics.geojson")
.then(res=>res.json())
.then(data=>{
  L.geoJSON(data,{
    pointToLayer:(f,ll)=>L.circleMarker(ll,{radius:4,color:"purple"}),
    onEachFeature:(f,l)=>{
      l.bindPopup("ğŸ©º Ø¹ÙŠØ§Ø¯Ø©");
    }
  }).addTo(clinicsLayer);
});

// ================== Ø§Ù„ÙˆØ¯ÙŠØ§Ù† ==================
fetch("wadis.geojson")
.then(res=>res.json())
.then(data=>{
  L.geoJSON(data,{
    style:{color:"brown"},
    onEachFeature:(f,l)=>{
      l.bindPopup("ÙˆØ§Ø¯ÙŠ");
    }
  }).addTo(wadisLayer);
});

// ================== Ø§Ù„Ø¢Ø¨Ø§Ø± ==================
fetch("Wells.geojson")
.then(res=>res.json())
.then(data=>{
  L.geoJSON(data,{
    pointToLayer:(f,ll)=>L.circleMarker(ll,{radius:4,color:"cyan"}),
    onEachFeature:(f,l)=>{
      l.bindPopup("Ø¨Ø¦Ø± Ù…ÙŠØ§Ù‡");
    }
  }).addTo(wellsLayer);
});

// ================== Ø§Ù„Ø·Ø±Ù‚ ==================
fetch("roads.json")
.then(res=>res.json())
.then(data=>{
  L.geoJSON(data,{
    style:{color:"gray"},
    onEachFeature:(f,l)=>{
      l.bindPopup("Ø·Ø±ÙŠÙ‚");
    }
  }).addTo(roadsLayer);
});

// ================== Ø§Ù„ØªØ¬Ù…Ø¹Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ© (Ø§Ù„Ø£Ù‡Ù…) ==================
fetch("tgmooat.json")
.then(res => res.json())
.then(data => {

  L.geoJSON(data, {
    style: f => ({
      color: "#000",
      fillColor: "#2ecc71",
      fillOpacity: 0.5
    }),

    onEachFeature: function(feature, layer){

      var population = feature.properties.population || 0;
      var schoolsCount = 0;

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ¬Ù…Ø¹
      schoolsLayer.eachLayer(s=>{
        if(layer.getBounds().contains(s.getLatLng())){
          schoolsCount++;
        }
      });

      var neededSchools = Math.ceil(population / 5000);
      var status = schoolsCount < neededSchools
        ? "<span class='bad'>âŒ ÙŠÙˆØ¬Ø¯ Ù†Ù‚Øµ Ù…Ø¯Ø§Ø±Ø³</span>"
        : "<span class='good'>âœ… ÙƒØ§ÙÙ</span>";

      // Ø§Ù‚ØªØ±Ø§Ø­ Ù…ÙˆÙ‚Ø¹ Ù…Ø¯Ø±Ø³Ø©
      if(schoolsCount < neededSchools){
        var center = layer.getBounds().getCenter();

        var price =
          population > 20000 ? "Ù…Ø±ØªÙØ¹" :
          population > 10000 ? "Ù…ØªÙˆØ³Ø·" : "Ù…Ù†Ø®ÙØ¶";

        L.marker(center,{
          icon: L.icon({
            iconUrl:"https://maps.google.com/mapfiles/ms/icons/green-dot.png",
            iconSize:[32,32]
          })
        })
        .bindPopup(
          "<b>Ù…ÙˆÙ‚Ø¹ Ù…Ù‚ØªØ±Ø­ Ù„Ù…Ø¯Ø±Ø³Ø©</b><br>" +
          "Ø§Ù„Ø³Ø¨Ø¨: Ù†Ù‚Øµ Ù…Ø¯Ø§Ø±Ø³<br>" +
          "ØªØ®Ù…ÙŠÙ† Ø³Ø¹Ø± Ø§Ù„Ø£Ø±Ø¶: <b>" + price + "</b>"
        )
        .addTo(proposedSchoolsLayer);
      }

      layer.bindPopup(
        "<div class='popup-title'>ØªØ¬Ù…Ø¹ Ø³ÙƒÙ†ÙŠ</div>" +
        "Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù†: " + population + "<br>" +
        "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³: " + schoolsCount + "<br>" +
        "Ø§Ù„Ø­Ø§Ù„Ø©: " + status
      );
    }
  }).addTo(settlementsLayer);
});

// ================== Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø·Ø¨Ù‚Ø§Øª ==================
L.control.layers(null,{
  "Ø§Ù„ØªØ¬Ù…Ø¹Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ©": settlementsLayer,
  "Ø§Ù„Ù…Ø¯Ø§Ø±Ø³": schoolsLayer,
  "Ù…ÙˆØ§Ù‚Ø¹ Ù…Ù‚ØªØ±Ø­Ø© Ù„Ù…Ø¯Ø§Ø±Ø³": proposedSchoolsLayer,
  "Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª": hospitalsLayer,
  "Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª": clinicsLayer,
  "Ø§Ù„ÙˆØ¯ÙŠØ§Ù†": wadisLayer,
  "Ø§Ù„Ø¢Ø¨Ø§Ø±": wellsLayer,
  "Ø§Ù„Ø·Ø±Ù‚": roadsLayer
}).addTo(map);

</script>
</body>
</html>
