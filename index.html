<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<title>Web GIS – Ramallah Schools Project</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

<style>
body { margin:0; font-family:Arial }
#map { height:100vh }
</style>
</head>

<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// 1️⃣ إنشاء الخريطة
var map = L.map("map").setView([31.9, 35.2], 11);

// 2️⃣ إضافة خريطة الأساس
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "© OpenStreetMap"
}).addTo(map);

// 3️⃣ تحميل طبقة التجمعات السكنية
fetch("tgmooat.json")
  .then(function(response){
    return response.json();
  })
  .then(function(data){

    var tgLayer = L.geoJSON(data, {
      style: {
        color: "black",
        weight: 1,
        fillColor: "#7fcdbb",
        fillOpacity: 0.5
      },

      onEachFeature: function (feature, layer) {
        var name = feature.properties["اسم_التجمع"];
        var pop  = feature.properties["تقديرات_السكان_2020"];

        layer.bindPopup(
          "<b>اسم التجمع:</b> " + name + "<br>" +
          "<b>عدد السكان:</b> " + pop
        );
      }
    }).addTo(map);

    // تكبير الخريطة على التجمعات
    map.fitBounds(tgLayer.getBounds());
  });
</script>
  // =======================
// 4️⃣ تحميل طبقة المدارس
// =======================
fetch("Ramallah_Schools.json")
  .then(response => response.json())
  .then(function(schoolsData){

    // عرض المدارس كنقاط
    var schoolsLayer = L.geoJSON(schoolsData, {
      pointToLayer: function(feature, latlng){
        return L.circleMarker(latlng, {
          radius: 5,
          color: "blue",
          fillOpacity: 0.8
        });
      }
    }).addTo(map);

    // تحديث Popup التجمعات لإظهار عدد المدارس
    tgLayer.eachLayer(function(layer){
      var count = 0;

      schoolsData.features.forEach(function(school){
        if (turf.booleanPointInPolygon(school, layer.feature)) {
          count++;
        }
      });

      var name = layer.feature.properties["اسم_التجمع"];
      var pop  = layer.feature.properties["تقديرات_السكان_2020"];

      layer.bindPopup(
        "<b>اسم التجمع:</b> " + name + "<br>" +
        "<b>عدد السكان:</b> " + pop + "<br>" +
        "<b>عدد المدارس:</b> " + count
      );
    });

  });


</body>
</html>

