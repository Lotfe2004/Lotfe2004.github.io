<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Ramallah Waste Containers Map - Updated with Video</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />

  <style>
    body {
      margin: 0px;
      height: 100%;
      width: 100%;
    }

    #map {
      position: absolute;
      width: 100%;
      top: 0px;
      bottom: 0;
    }
    
    /* Style for the filter dropdown control */
    .leaflet-control-filter {
        background-color: white;
        padding: 6px 10px;
        border-radius: 4px;
        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
        margin-right: 10px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        font-weight: bold;
    }
    .leaflet-control-filter select {
        padding: 4px;
        border: 1px solid #ccc;
        border-radius: 3px;
    }

    /* Responsive iframe container for the video */
    .video-container {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        height: 0;
        overflow: hidden;
        margin-top: 5px;
        border-radius: 4px;
    }
    .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script>
    // ----------------------------------------------------
    // 1. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    // ----------------------------------------------------
    let zonesLayer;
    let wasteContainersLayer;
    let layerControl; 
    const allContainersData = []; 

    // Map Initialization Options
    const mapOptions = {
      zoomSnap: 0.5,
      center: [31.9045, 35.2045], 
      zoom: 16, 
    };

    const map = L.map("map", mapOptions);

    // Dark Tile Layer (Default Base Map)
    const darkTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 20
    }).addTo(map);

    // ----------------------------------------------------
    // 2. Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„ØªØµÙÙŠØ©
    // ----------------------------------------------------

    /**
     * Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø·Ø¨Ù‚Ø© Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ù†ÙØ§ÙŠØ§Øª ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù„ÙˆÙ†ÙŠ ÙˆØ§Ù„Ù€ Popups.
     */
    function createContainersLayer(data) {
        if (wasteContainersLayer && map.hasLayer(wasteContainersLayer)) {
            map.removeLayer(wasteContainersLayer);
        }

        wasteContainersLayer = L.geoJson(data, {
            pointToLayer: function(feature, latlng) {
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù†ÙØ§ÙŠØ§Øª
                let color;
                switch (feature.properties.TYPE_OF_WA) {
                    case 'Household':
                        color = '#E9573F'; // Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ†
                        break;
                    case 'Recycling':
                        color = '#4CAF50'; // Ø£Ø®Ø¶Ø±
                        break;
                    case 'Plastics':
                        color = '#3F51B5'; // Ø£Ø²Ø±Ù‚
                        break;
                    default:
                        color = '#FBC02D'; // Ø£ØµÙØ± Ø°Ù‡Ø¨ÙŠ
                }
                
                return L.circleMarker(latlng, {
                    radius: 7, 
                    fillColor: color,
                    color: color,
                    weight: 1.5,
                    opacity: 1,
                    fillOpacity: 0.85
                });
            },
            onEachFeature: function(feature, layer) {
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø­Ø§ÙˆÙŠØ© (Ø§ÙØªØ±Ø§Ø¶Ø§Ù‹ Ø£Ù†Ù‡Ø§ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯)
                let imageName;
                switch (feature.properties.TYPE_OF_WA) {
                    case 'Household':
                        imageName = 'household-bin.jpg'; // Ø§ÙØªØ±Ø¶ ÙˆØ¬ÙˆØ¯ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©
                        break;
                    case 'Recycling':
                        imageName = 'recycling-bin.jpg'; // Ø§ÙØªØ±Ø¶ ÙˆØ¬ÙˆØ¯ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©
                        break;
                    default:
                        imageName = 'default-bin.jpg'; // Ø§ÙØªØ±Ø¶ ÙˆØ¬ÙˆØ¯ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©
                }

                // Ù…Ø­ØªÙˆÙ‰ Popup Ø§Ù„Ø­Ø§ÙˆÙŠØ© (ØµÙˆØ±Ø© + Ù…Ø¹Ù„ÙˆÙ…Ø§Øª)
                const popupContent = `
                    <h4 style="margin: 5px 0; color: ${layer.options.fillColor}">ğŸ§º Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§ÙˆÙŠØ©</h4>
                    <img src="${imageName}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§ÙˆÙŠØ©" style="width:100%; max-height: 120px; object-fit: contain; border-radius: 3px; display: block; margin-bottom: 5px;"><hr style="margin: 5px 0; border-color: #eee;">
                    <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${feature.properties.TYPE_OF_WA || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                    <strong>Ø§Ù„Ø³Ø¹Ø©:</strong> ${feature.properties.SIZE_IN_M3 || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} Ù…Â³
                `;
                layer.bindPopup(popupContent, { maxWidth: 280 }); 
            }
        });
        
        wasteContainersLayer.addTo(map);
        updateLayerControl(); 
    }

    /**
     * Ø¯Ø§Ù„Ø© Ù„ØªØµÙÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚Ø©. (Ù„Ù… ÙŠØªØºÙŠØ±)
     */
    function filterContainers(wasteType) {
        if (wasteType === 'All') {
            createContainersLayer(allContainersData);
        } else {
            const filteredFeatures = allContainersData.features.filter(feature => 
                feature.properties.TYPE_OF_WA === wasteType
            );
            const filteredGeoJson = {
                "type": "FeatureCollection",
                "features": filteredFeatures
            };
            createContainersLayer(filteredGeoJson);
        }
    }

    /**
     * Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø·Ø¨Ù‚Ø§Øª. (Ù„Ù… ÙŠØªØºÙŠØ±)
     */
    function updateLayerControl() {
        if (zonesLayer && wasteContainersLayer) {
            if (layerControl) {
                map.removeControl(layerControl);
            }

            const baseLayers = {
              "Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¯Ø§ÙƒÙ†Ø©": darkTileLayer
            };
            const overlays = {
              "Ù…Ù†Ø§Ø·Ù‚ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ ğŸ™ï¸": zonesLayer,
              "Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ù†ÙØ§ÙŠØ§Øª ğŸ—‘ï¸": wasteContainersLayer
            };

            layerControl = L.control.layers(baseLayers, overlays).addTo(map);
        }
    }
    
    /**
     * Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± ØªØ­ÙƒÙ… Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµ (Dropdown). (Ù„Ù… ÙŠØªØºÙŠØ±)
     */
    function addFilterControl() {
        const wasteTypes = ['All']; 
        allContainersData.features.forEach(feature => {
            const type = feature.properties.TYPE_OF_WA;
            if (type && !wasteTypes.includes(type)) {
                wasteTypes.push(type);
            }
        });

        const FilterControl = L.Control.extend({
            onAdd: function(map) {
                const container = L.DomUtil.create('div', 'leaflet-control-filter');
                container.innerHTML = '<strong>ØªØµÙÙŠØ© Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª: </strong>';
                
                const select = L.DomUtil.create('select', 'waste-type-select', container);
                wasteTypes.forEach(type => {
                    const option = L.DomUtil.create('option', '', select);
                    option.value = type;
                    option.text = (type === 'All' ? 'âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹' : type);
                });

                L.DomEvent.disableClickPropagation(container);
                
                select.onchange = function(e) {
                    filterContainers(e.target.value);
                };

                return container;
            },
            onRemove: function(map) {}
        });

        new FilterControl({ position: 'topright' }).addTo(map);
    }

    // ----------------------------------------------------
    // 3. ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª GeoJSON
    // ----------------------------------------------------

    // ØªØ­Ù…ÙŠÙ„ Ù…Ù†Ø§Ø·Ù‚ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ (Zones) - ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù‡Ù†Ø§
    $.getJSON("RamallahZones.json", function(RZ) {
      zonesLayer = L.geoJson(RZ, {
        style: function(feature) {
          return {
            fillColor: "#FAD02E", 
            fillOpacity: 0.15, 
            color: "#FAD02E",
            weight: 2,
            opacity: 0.9
          };
        },
        onEachFeature: function(feature, layer) {
            // **Ø§Ù„Ù…ÙŠØ²Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø¯Ù…Ø¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ**
            // ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹ÙŠÙŠÙ† Video ID Ù„ÙƒÙ„ Ù…Ù†Ø·Ù‚Ø© ÙÙŠ Ù…Ù„Ù RamallahZones.json 
            // Ù†Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§ Ù…Ø«Ø§Ù„ÙŠÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠÙŠÙ†:
            let videoId = feature.properties.NAME === 'Zone A' ? 'k_6kS8N2j2o' : 'lE2D0qWnS-E'; // Ù…Ø«Ø§Ù„ÙŠÙ† Ù„Ø±Ù…ÙˆØ² ÙÙŠØ¯ÙŠÙˆ

            // Ù…Ø­ØªÙˆÙ‰ Popup Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (ÙŠØ´Ù…Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ)
            const popupContent = `
                <h4 style="margin: 5px 0;">ğŸ“ Ù…Ù†Ø·Ù‚Ø© Ø±Ø§Ù… Ø§Ù„Ù„Ù‡: ${feature.properties.NAME || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</h4>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/${videoId}" 
                            title="ÙÙŠØ¯ÙŠÙˆ ØªÙˆØ¶ÙŠØ­ÙŠ Ù„Ù„Ù…Ù†Ø·Ù‚Ø©" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                    </iframe>
                </div>
            `;
            // ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù€ Popup Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„
            layer.bindPopup(popupContent, { maxWidth: 350 }); 
        }
      });
      zonesLayer.addTo(map); 
      updateLayerControl(); 
    }).fail(function() {
        console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ RamallahZones.json");
    });

    // ØªØ­Ù…ÙŠÙ„ Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ù†ÙØ§ÙŠØ§Øª (Waste Containers)
    $.getJSON("wasteContainer.json", function(WC) {
      allContainersData.features = WC.features;
      allContainersData.type = WC.type;
      
      createContainersLayer(allContainersData); 
      
      updateLayerControl(); 
      addFilterControl(); 
      
    }).fail(function() {
        console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ wasteContainer.json");
    });
    
  </script>
</body>

</html>
</body>

</html>

