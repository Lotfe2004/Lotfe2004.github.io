<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<title>Web GIS â€“ Ramallah</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

<style>
body { margin:0; font-family:Arial }
#map { height:100vh }
</style>
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/@turf/turf/turf.min.js"></script>

<script>
// =====================
// Ø§Ù„Ø®Ø±ÙŠØ·Ø©
// =====================
var map = L.map("map").setView([31.9,35.2],11);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
  attribution:"Â© OpenStreetMap"
}).addTo(map);

// =====================
// Ù…ØªØºÙŠØ±Ø§Øª
// =====================
var tgLayer, schoolsData;

// =====================
// 1ï¸âƒ£ Ø§Ù„ØªØ¬Ù…Ø¹Ø§Øª (ØªØ­Øª Ø§Ù„Ø¬Ù…ÙŠØ¹)
// =====================
fetch("tgmooat.json")
.then(r=>r.json())
.then(data=>{

  tgLayer = L.geoJSON(data,{
    style:{
      color:"#000",
      weight:1,
      fillColor:"#ddd",
      fillOpacity:0.5
    }
  }).addTo(map);

  map.fitBounds(tgLayer.getBounds());

  loadSchools();
  loadHospitals();
  loadRoads();
  loadWadis();
});

// =====================
// 2ï¸âƒ£ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ (ÙÙˆÙ‚ Ø§Ù„ØªØ¬Ù…Ø¹Ø§Øª)
// =====================
function loadSchools(){
fetch("schools.json")
.then(r=>r.json())
.then(data=>{
  schoolsData = data;

  L.geoJSON(data,{
    pointToLayer:(f,latlng)=>
      L.circleMarker(latlng,{
        radius:5,
        color:"blue",
        fillOpacity:0.9
      }),
    onEachFeature:(f,l)=>{
      l.bindPopup(
        "<b>ğŸ« Ù…Ø¯Ø±Ø³Ø©</b><br>"+
        (f.properties.NAME || "")
      );
    }
  }).addTo(map);

  analyzeTgmooat();
});
}

// =====================
// 3ï¸âƒ£ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª
// =====================
function loadHospitals(){
fetch("hospitals.json")
.then(r=>r.json())
.then(data=>{
  L.geoJSON(data,{
    pointToLayer:(f,latlng)=>
      L.marker(latlng),
    onEachFeature:(f,l)=>{
      l.bindPopup(
        "<b>ğŸ¥ Ù…Ø³ØªØ´ÙÙ‰</b><br>"+
        (f.properties.NAME || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ")
      );
    }
  }).addTo(map);
});
}

// =====================
// 4ï¸âƒ£ Ø§Ù„Ø·Ø±Ù‚
// =====================
function loadRoads(){
fetch("roads.json")
.then(r=>r.json())
.then(data=>{
  L.geoJSON(data,{
    style:{color:"#555",weight:2},
    onEachFeature:(f,l)=>{
      l.bindPopup(
        "<b>ğŸ›£ Ø·Ø±ÙŠÙ‚</b><br>"+
        (f.properties.TYPE || "")
      );
    }
  }).addTo(map);
});
}

// =====================
// 5ï¸âƒ£ Ø§Ù„ÙˆØ¯ÙŠØ§Ù†
// =====================
function loadWadis(){
fetch("wadis.json")
.then(r=>r.json())
.then(data=>{
  L.geoJSON(data,{
    style:{color:"cyan",weight:2,dashArray:"4,4"},
    onEachFeature:(f,l)=>{
      l.bindPopup(
        "<b>ğŸŒŠ ÙˆØ§Ø¯ÙŠ</b><br>"+
        (f.properties.NAME || "")
      );
    }
  }).addTo(map);
});
}

// =====================
// 6ï¸âƒ£ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ¬Ù…Ø¹Ø§Øª + Popup
// =====================
function analyzeTgmooat(){

tgLayer.eachLayer(function(layer){

  let count = 0;
  schoolsData.features.forEach(s=>{
    if(turf.booleanPointInPolygon(s,layer.feature)){
      count++;
    }
  });

  let name = layer.feature.properties["Ø§Ø³Ù…_Ø§Ù„ØªØ¬Ù…Ø¹"] || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  let pop  = layer.feature.properties["ØªÙ‚Ø¯ÙŠØ±Ø§Øª_Ø§Ù„Ø³ÙƒØ§Ù†_2020"] || 0;

  layer.bindPopup(
    "<b>ğŸ˜ Ø§Ù„ØªØ¬Ù…Ø¹:</b> "+name+"<br>"+
    "<b>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù†:</b> "+pop+"<br>"+
    "<b>ğŸ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³:</b> "+count
  );
});
}
</script>
</body>
</html>
