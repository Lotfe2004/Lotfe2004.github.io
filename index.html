<!DOCTYPE html>

<html lang="en">

<head>
Â  <meta charset="utf-8" />

Â  <title>Ramallah Waste Containers - Final Code</title>

Â  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />

Â  <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

Â  <style>
Â  Â  /* style the body */
Â  Â  body {
Â  Â  Â  margin: 0px;
Â  Â  Â  height: 100%;
Â  Â  Â  width: 100%;
Â  Â  }

Â  Â  /* style the map */
Â  Â  #map {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 100%;
Â  Â  Â  top: 0px;
Â  Â  Â  bottom: 0;
Â  Â  }
Â  </style>
</head>

<body>
Â  <div id="map"></div>

Â  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>

Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

Â  <script>
Â  Â  // ----------------------------------------------------
Â  Â  // 1. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
Â  Â  // ----------------------------------------------------
Â  Â  let zonesLayer;Â 
Â  Â  let wasteContainersLayer;
Â  Â  let allContainersFeatureCollection = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ù„Ù€ Turf
Â  Â  let layerControl;
    let containersData = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª GeoJSON Ù„Ù„Ø­Ø§ÙˆÙŠØ§Øª Ù…Ø¤Ù‚ØªØ§Ù‹

Â  Â  // define map options
Â  Â  const mapOptions = {
Â  Â  Â  zoomSnap: 0.5,
Â  Â  Â  center: [31.9045, 35.2045],Â 
Â  Â  Â  zoom: 17.5,Â 
Â  Â  };

Â  Â  // define the map with the options above
Â  Â  const map = L.map("map", mapOptions);

Â  Â  // Default Base Map
Â  Â  const darkTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
Â  Â  Â  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
Â  Â  Â  subdomains: 'abcd',
Â  Â  Â  maxZoom: 20
Â  Â  }).addTo(map);

Â  Â  // ----------------------------------------------------
Â  Â  // 2. Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
Â  Â  // ----------------------------------------------------

Â  Â  // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
Â  Â  function updateLayerControl() {
Â  Â  Â  Â  if (zonesLayer && wasteContainersLayer) {
Â  Â  Â  Â  Â  Â  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
Â  Â  Â  Â  Â  Â  if (layerControl) {
Â  Â  Â  Â  Â  Â  Â  Â  map.removeControl(layerControl);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const baseLayers = {
Â  Â  Â  Â  Â  Â  Â  "Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¯Ø§ÙƒÙ†Ø©": darkTileLayer
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  const overlays = {
Â  Â  Â  Â  Â  Â  Â  "Ù…Ù†Ø§Ø·Ù‚ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ ğŸ™ï¸": zonesLayer,
Â  Â  Â  Â  Â  Â  Â  "Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ù†ÙØ§ÙŠØ§Øª ğŸ—‘ï¸": wasteContainersLayer
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  layerControl = L.control.layers(baseLayers, overlays).addTo(map);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
Â  Â  function defaultZoneStyle(feature) {
Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  fillColor: "yellow",
Â  Â  Â  Â  Â  Â  fillOpacity: 0.3,
Â  Â  Â  Â  Â  Â  color: "yellow",
Â  Â  Â  Â  Â  Â  weight: 1.0,
Â  Â  Â  Â  Â  Â  opacity: 0.7
Â  Â  Â  Â  };
Â  Â  }
Â  Â Â 
Â  Â  // ----------------------------------------------------
Â  Â  // 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
Â  Â  // ----------------------------------------------------

Â  Â  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠ
Â  Â  $.when(
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
        $.getJSON("RamallahZones.json"),
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
        $.getJSON("wasteContainer.json")
    ).done(function(zonesResponse, containersResponse) {
        // [0] ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ [1] Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        const RZ = zonesResponse[0];
        const WC = containersResponse[0];

        // 1. **ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙˆØ¥Ø¶Ø§ÙØªÙ‡Ø§ Ø£ÙˆÙ„Ø§Ù‹ (Ù„ØªØ¨Ù‚Ù‰ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„)**
Â  Â  Â  Â  zonesLayer = L.geoJson(RZ, {
Â  Â  Â  Â  Â  Â  style: defaultZoneStyle, 
Â  Â  Â  Â  Â  Â  onEachFeature: function(feature, layer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.on('click', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (allContainersFeatureCollection) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const zonePolygon = turf.feature(feature.geometry);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pointsInZone = turf.pointsWithinPolygon(allContainersFeatureCollection, zonePolygon);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const count = pointsInZone.features.length;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const popupContent = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>ğŸ“ Ù…Ù†Ø·Ù‚Ø© Ø±Ø§Ù… Ø§Ù„Ù„Ù‡</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${feature.properties.NAME || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <hr style="margin: 5px 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„ÙƒÙ„ÙŠ:</strong> <span style="font-weight: bold; color: green; font-size: 1.1em;">${count}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ÙØªØ­ Popup Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.bindPopup(popupContent).openPopup(e.latlng);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Zone Name: " + feature.properties.NAME);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± ÙÙˆÙ‚Ù‡Ø§ (Hover Effect)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.on('mouseover', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.setStyle({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 3,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#FF0000', 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.5Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.openTooltip();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.on('mouseout', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  zonesLayer.resetStyle(layer);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Tooltip ÙŠØ¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.bindTooltip(feature.properties.NAME, {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  permanent: false,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  direction: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: 'zone-tooltip'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  zonesLayer.addTo(map); // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø£ÙˆÙ„Ø§Ù‹ (Ù„ØªÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„)

        // 2. **ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª ÙˆØ¥Ø¶Ø§ÙØªÙ‡Ø§ Ø«Ø§Ù†ÙŠØ§Ù‹ (Ù„ØªÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰)**
Â  Â  Â  Â  // ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª ÙÙŠ Ù…ØªØºÙŠØ± Turf.js Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„
Â  Â  Â  Â  allContainersFeatureCollection = turf.featureCollection(WC.features);

Â  Â  Â  Â  wasteContainersLayer = L.geoJson(WC, {
Â  Â  Â  Â  Â  Â  pointToLayer: function(feature, latlng) {
Â  Â  Â  Â  Â  Â  Â  Â  return L.circleMarker(latlng, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  radius: 5,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: "orange",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: "orange",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.8
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  onEachFeature: function(feature, layer) {
Â  Â  Â  Â  Â  Â  Â  Â  const content = `<strong>Ù†ÙˆØ¹ Ø§Ù„Ù†ÙØ§ÙŠØ§Øª:</strong> ${feature.properties.TYPE_OF_WA || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
Â  Â  Â  Â  Â  Â  Â  Â  layer.bindPopup(content);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  wasteContainersLayer.addTo(map); // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø«Ø§Ù†ÙŠØ§Ù‹ (Ù„ØªÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰)
        
        // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ØªØ§ Ø§Ù„Ø·Ø¨Ù‚ØªÙŠÙ†
Â  Â  Â  Â  updateLayerControl();
        
    }).fail(function() {
        console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù…Ù„ÙØ§Øª GeoJSON. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ wasteContainer.json Ùˆ RamallahZones.json.");
    });
Â  </script>
</body>

</html>
